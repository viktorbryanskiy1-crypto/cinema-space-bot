<!-- templates/trailers.html -->
<div class="content-section">
    <!-- –°–µ—Ç–∫–∞ —Ç—Ä–µ–π–ª–µ—Ä–æ–≤ -->
    <div class="content-grid" id="trailers-grid">
        {% if trailers %}
            {% for trailer in trailers %}
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—Ä–µ–π–ª–µ—Ä–∞ -->
            <div class="video-card" data-id="{{ trailer.id }}" data-type="trailer">
                <div class="video-thumbnail">
                    {% if trailer.preview_url %}
                        <!-- –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–≤—å—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ -->
                        <img src="{{ trailer.preview_url }}" alt="{{ trailer.title }}" loading="lazy">
                    {% else %}
                        <!-- –ï—Å–ª–∏ –ø—Ä–µ–≤—å—é –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É -->
                        <div class="video-placeholder">üé•</div>
                    {% endif %}
                </div>
                <div class="video-info">
                    <!-- –¢–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å–µ—Ç–∫–µ -->
                    <h3 class="video-title">{{ trailer.title }}</h3>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–π–ª–µ—Ä–æ–≤ -->
            <div class="no-results">
                <div style="text-align: center; padding: 50px; color: var(--accent);">
                    <h2>üé• –¢—Ä–µ–π–ª–µ—Ä—ã</h2>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–π–ª–µ—Ä–æ–≤</p>
                    <button id="add-trailer-btn-alt" class="tab-btn" style="margin-top: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–π–ª–µ—Ä</button>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–π–ª–µ—Ä–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏) -->
<div id="add-trailer-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('add-trailer-modal')">&times;</button>
        <h3>üé• –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–π–ª–µ—Ä</h3>
        <form id="add-trailer-form" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–π–ª–µ—Ä–∞" required
                style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;"><br>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ:</label>
                <div>
                    <input type="radio" name="video_type" value="upload" id="trailer_video_upload" checked>
                    <label for="trailer_video_upload">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</label>
                </div>
                <div>
                    <input type="radio" name="video_type" value="url" id="trailer_video_url">
                    <label for="trailer_video_url">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ</label>
                </div>
            </div>

            <div id="trailer-file-section">
                <input type="file" name="video_file" accept="video/*"
                    style="width: 100%; margin-bottom: 15px; color: white;">
                <small style="color: var(--text-secondary);">–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 50MB. –§–æ—Ä–º–∞—Ç—ã: MP4, AVI, MOV, WEBM</small>
            </div>

            <div id="trailer-url-section" style="display: none;">
                <input type="text" name="video_url" placeholder="URL –≤–∏–¥–µ–æ (YouTube, Vimeo, Telegram, –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞)"
                    style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;">
                <small style="color: var(--text-secondary);">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ YouTube, Vimeo, Telegram –∏ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã.</small>
            </div>

            <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–π–ª–µ—Ä–∞" required
                style="width: 100%; padding: 12px; margin-bottom: 15px; height: 100px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;"></textarea><br>

            <button type="submit" class="submit-btn" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–π–ª–µ—Ä</button>
            <button type="button" onclick="closeModal('add-trailer-modal')" class="tab-btn"
                style="width: 100%; margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>
</div>

<script>
// --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏ ---
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —Ç—Ä–µ–π–ª–µ—Ä–æ–≤
    document.querySelectorAll('.video-card[data-type="trailer"]').forEach(card => {
        card.addEventListener('click', function() {
            const trailerId = this.getAttribute('data-id');
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π
            window.location.href = `/trailers/${trailerId}`;
        });
    });

    // --- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—é –≤–∞—à—É —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏ —Ñ–æ—Ä–º ---
    // (–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –≤ main.js,
    //  —ç—Ç–æ—Ç –∫–æ–¥ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º, –µ—Å–ª–∏ main.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

    // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ main.js, –µ—Å–ª–∏ –æ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
    if (typeof showAddTrailerModal === 'undefined') {
        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.style.display = 'flex';
        }
        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.style.display = 'none';
        }
        function showAddTrailerModal() {
            showModal('add-trailer-modal');
        }

        // –ü—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        const addBtn = document.getElementById('add-trailer-btn');
        const addBtnAlt = document.getElementById('add-trailer-btn-alt');
        if (addBtn) addBtn.addEventListener('click', showAddTrailerModal);
        if (addBtnAlt) addBtnAlt.addEventListener('click', showAddTrailerModal);

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ / URL –≤–∏–¥–µ–æ
        document.addEventListener('change', function(e) {
            if (e.target.name === 'video_type' && e.target.closest('#add-trailer-modal')) {
                if (e.target.value === 'upload') {
                    document.getElementById('trailer-file-section').style.display = 'block';
                    document.getElementById('trailer-url-section').style.display = 'none';
                } else {
                    document.getElementById('trailer-file-section').style.display = 'none';
                    document.getElementById('trailer-url-section').style.display = 'block';
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–π–ª–µ—Ä–∞
        const form = document.getElementById('add-trailer-form');
        if (form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const videoType = this.querySelector('input[name="video_type"]:checked').value;

                try {
                    let response;
                    if (videoType === 'upload' && this.querySelector('input[name="video_file"]').files[0]) {
                        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
                        response = await fetch('/api/add_trailer', {
                            method: 'POST',
                            body: formData
                        });
                    } else {
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ URL
                        const jsonData = {
                            title: formData.get('title'),
                            description: formData.get('description'),
                            video_url: formData.get('video_url') || ''
                        };
                        response = await fetch('/api/add_trailer', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(jsonData)
                        });
                    }

                    const result = await response.json();
                    if (result.success) {
                        closeModal('add-trailer-modal');
                        // –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ç–∫—É
                        // –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é. –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É.
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–π–ª–µ—Ä'));
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
                }
            });
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', function(e) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    }
});
</script>
