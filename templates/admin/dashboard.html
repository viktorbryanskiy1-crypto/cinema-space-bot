<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ö–∏–Ω–æ–í—Å–µ–ª–µ–Ω–Ω–∞—è</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .tab-content { display: none; margin-top: 30px; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        button { padding: 10px 20px; border: none; border-radius: 5px; background: var(--accent); color: #fff; cursor: pointer; }
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <div class="container">
        <nav class="navbar" style="margin-bottom: 30px;">
            <h1>üìä –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div>
                <a href="#" class="tab-btn" data-tab="stats" style="margin-right: 10px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="#" class="tab-btn" data-tab="add-video" style="margin-right: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</a>
                <a href="{{ url_for('admin_content') }}" class="tab-btn" style="margin-right: 10px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</a>
                <a href="{{ url_for('admin_access_settings') }}" class="tab-btn" style="margin-right: 10px;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞</a>
                <a href="{{ url_for('admin_logout') }}" class="tab-btn" style="background: linear-gradient(45deg, #ff6b6b, #ff4757);">–í—ã–π—Ç–∏</a>
            </div>
        </nav>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="stats" class="tab-content active">
            <h2 style="text-align: center; margin-bottom: 30px; background: linear-gradient(45deg, var(--accent), var(--accent-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ moments_count }}</div>
                    <div class="stat-label">–ú–æ–º–µ–Ω—Ç–æ–≤ –∏–∑ –∫–∏–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ trailers_count }}</div>
                    <div class="stat-label">–¢—Ä–µ–π–ª–µ—Ä–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ news_count }}</div>
                    <div class="stat-label">–ù–æ–≤–æ—Å—Ç–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ comments_count }}</div>
                    <div class="stat-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                </div>
            </div>
        </div>

        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ -->
        <div id="add-video" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ</h2>
            <form id="addVideoForm">
                <div class="form-group">
                    <label for="content_type">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                    <select id="content_type" name="content_type" required>
                        <option value="moment">–ú–æ–º–µ–Ω—Ç</option>
                        <option value="trailer">–¢—Ä–µ–π–ª–µ—Ä</option>
                        <option value="news">–ù–æ–≤–æ—Å—Ç—å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</label>
                    <input type="text" id="title" name="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                <div class="form-group">
                    <label for="video_url">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ / Telegram –ø–æ—Å—Ç</label>
                    <input type="text" id="video_url" name="video_url" placeholder="https://t.me/channel/123 –∏–ª–∏ –ø—Ä—è–º–æ–π URL" required>
                </div>
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
            </form>
            <div id="addVideoMessage" style="margin-top: 20px; text-align: center;"></div>
        </div>

        <div style="text-align: center; margin-top: 50px;">
            <a href="{{ url_for('index') }}" class="tab-btn">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</a>
        </div>
    </div>

    <script>
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        const tabs = document.querySelectorAll('.tab-btn[data-tab]');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', e => {
                e.preventDefault();
                const target = tab.dataset.tab;
                contents.forEach(c => c.classList.remove('active'));
                document.getElementById(target).classList.add('active');
            });
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ fetch
        const form = document.getElementById('addVideoForm');
        form.addEventListener('submit', async e => {
            e.preventDefault();
            const content_type = document.getElementById('content_type').value;
            const title = document.getElementById('title').value;
            const video_url = document.getElementById('video_url').value;
            const msgDiv = document.getElementById('addVideoMessage');
            msgDiv.textContent = '‚è≥ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';

            try {
                const response = await fetch(`/api/add_${content_type}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, description: '–î–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É', video_url })
                });
                const data = await response.json();
                if(data.success){
                    msgDiv.textContent = '‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!';
                    form.reset();
                } else {
                    msgDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch(err){
                msgDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ' + err;
            }
        });
    </script>
</body>
</html>
