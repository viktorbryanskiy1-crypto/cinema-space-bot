<!-- templates/admin/add_video.html -->
{% extends 'admin/base.html' %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="container" style="max-width: 700px; margin-top: 30px;">
    <h2 class="text-center mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –≤–∏–¥–µ–æ</h2>

    <form id="add-video-form">
        <div class="mb-3">
            <label for="video-title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" class="form-control" id="video-title" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ">
        </div>

        <div class="mb-3">
            <label for="video-description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea class="form-control" id="video-description" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–µ–æ"></textarea>
        </div>

        <div class="mb-3">
            <label for="video-type" class="form-label">–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ *</label>
            <select class="form-select" id="video-type" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                <option value="moment">üé¨ –ú–æ–º–µ–Ω—Ç</option>
                <option value="trailer">üé• –¢—Ä–µ–π–ª–µ—Ä</option>
                <option value="news">üì∞ –ù–æ–≤–æ—Å—Ç—å</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="video-url" class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç –≤ Telegram –∏–ª–∏ –ø—Ä—è–º–æ–π URL –≤–∏–¥–µ–æ *</label>
            <input type="url" class="form-control" id="video-url" required placeholder="https://t.me/your_channel/123 –∏–ª–∏ https://example.com/video.mp4">
            <div class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã Telegram.</div>
        </div>

        <button type="submit" class="btn btn-primary w-100">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
        <div id="message-area" class="mt-3"></div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('add-video-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const title = document.getElementById('video-title').value.trim();
    const description = document.getElementById('video-description').value.trim();
    const category = document.getElementById('video-type').value;
    const post_link = document.getElementById('video-url').value.trim();
    const messageArea = document.getElementById('message-area');

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    messageArea.innerHTML = '';

    if (!title || !post_link || !category) {
        messageArea.innerHTML = '<div class="alert alert-danger">‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.</div>';
        return;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const submitButton = document.querySelector('button[type="submit"]');
    const originalText = submitButton.textContent;
    submitButton.disabled = true;
    submitButton.innerHTML = '‚è≥ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';

    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ù–û–í–´–ô –º–∞—Ä—à—Ä—É—Ç
        const res = await fetch('/admin/add_video_json', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, description, category, post_link })
        });

        const data = await res.json();

        if (res.ok && data.success) {
            messageArea.innerHTML = '<div class="alert alert-success">‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!</div>';
            document.getElementById('add-video-form').reset();
        } else {
            const errorMsg = data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
            messageArea.innerHTML = `<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ${errorMsg}</div>`;
        }
    } catch (err) {
        console.error('Fetch error:', err);
        messageArea.innerHTML = '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</div>';
    } finally {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        setTimeout(() => {
            submitButton.disabled = false;
            submitButton.innerHTML = originalText;
        }, 500);
    }
});
</script>
{% endblock %}
