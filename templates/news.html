<!-- templates/news.html -->
<div class="content-section">
    <!-- –°–µ—Ç–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
    <div class="content-grid" id="news-grid">
        {% if news %}
            {% for news_item in news %}
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–æ–≤–æ—Å—Ç–∏ -->
            <div class="video-card" data-id="{{ news_item.id }}" data-type="news">
                <div class="video-thumbnail">
                    {% if news_item.image_url %}
                        <!-- –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ -->
                        <img src="{{ news_item.image_url }}" alt="{{ news_item.title }}" loading="lazy">
                    {% else %}
                        <!-- –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É -->
                        <div class="video-placeholder">üì∞</div>
                    {% endif %}
                </div>
                <div class="video-info">
                    <!-- –¢–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å–µ—Ç–∫–µ -->
                    <h3 class="video-title">{{ news_item.title }}</h3>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π -->
            <div class="no-results">
                <div style="text-align: center; padding: 50px; color: var(--accent);">
                    <h2>üì∞ –ù–æ–≤–æ—Å—Ç–∏</h2>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π</p>
                    <button id="add-news-btn-alt" class="tab-btn" style="margin-top: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å</button>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏) -->
<div id="add-news-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('add-news-modal')">&times;</button>
        <h3>üì∞ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h3>
        <form id="add-news-form" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" required
                style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;"><br>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                <div>
                    <input type="radio" name="image_type" value="upload" id="news_image_upload" checked>
                    <label for="news_image_upload">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</label>
                </div>
                <div>
                    <input type="radio" name="image_type" value="url" id="news_image_url">
                    <label for="news_image_url">–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                </div>
            </div>

            <div id="news-file-section">
                <input type="file" name="image_file" accept="image/*"
                    style="width: 100%; margin-bottom: 15px; color: white;">
                <small style="color: var(--text-secondary);">–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 16MB. –§–æ—Ä–º–∞—Ç—ã: PNG, JPG, JPEG, GIF, WEBP</small>
            </div>

            <div id="news-url-section" style="display: none;">
                <input type="text" name="image_url" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Telegram, –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞)"
                    style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;">
                <small style="color: var(--text-secondary);">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å—Å—ã–ª–∫–∏ –Ω–∞ Telegram –ø–æ—Å—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</small>
            </div>

            <textarea name="text" placeholder="–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏" required
                style="width: 100%; padding: 12px; margin-bottom: 15px; height: 150px; border: 1px solid var(--accent); border-radius: 10px; background: rgba(255,255,255,0.1); color: white;"></textarea><br>

            <button type="submit" class="submit-btn" style="width: 100%;">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
            <button type="button" onclick="closeModal('add-news-modal')" class="tab-btn"
                style="width: 100%; margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>
</div>

<script>
// --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –¥–µ—Ç–∞–ª–∏ ---
document.addEventListener('DOMContentLoaded', function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –Ω–æ–≤–æ—Å—Ç–µ–π
    document.querySelectorAll('.video-card[data-type="news"]').forEach(card => {
        card.addEventListener('click', function() {
            const newsId = this.getAttribute('data-id');
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π
            window.location.href = `/news/${newsId}`;
        });
    });

    // --- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—é –≤–∞—à—É —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏ —Ñ–æ—Ä–º ---
    // (–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –≤ main.js,
    //  —ç—Ç–æ—Ç –∫–æ–¥ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–º, –µ—Å–ª–∏ main.js –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏–ª–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

    // –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ main.js, –µ—Å–ª–∏ –æ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
    if (typeof showAddNewsModal === 'undefined') {
        function showModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.style.display = 'flex';
        }
        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.style.display = 'none';
        }
        function showAddNewsModal() {
            showModal('add-news-modal');
        }

        // –ü—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        const addBtn = document.getElementById('add-news-btn');
        const addBtnAlt = document.getElementById('add-news-btn-alt');
        if (addBtn) addBtn.addEventListener('click', showAddNewsModal);
        if (addBtnAlt) addBtnAlt.addEventListener('click', showAddNewsModal);

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ / URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.addEventListener('change', function(e) {
            if (e.target.name === 'image_type' && e.target.closest('#add-news-modal')) {
                if (e.target.value === 'upload') {
                    document.getElementById('news-file-section').style.display = 'block';
                    document.getElementById('news-url-section').style.display = 'none';
                } else {
                    document.getElementById('news-file-section').style.display = 'none';
                    document.getElementById('news-url-section').style.display = 'block';
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏
        const form = document.getElementById('add-news-form');
        if (form) {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const imageType = this.querySelector('input[name="image_type"]:checked').value;

                try {
                    let response;
                    if (imageType === 'upload' && this.querySelector('input[name="image_file"]').files[0]) {
                        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
                        response = await fetch('/api/add_news', {
                            method: 'POST',
                            body: formData
                        });
                    } else {
                        // –û—Ç–ø—Ä–∞–≤–∫–∞ URL
                        const jsonData = {
                            title: formData.get('title'),
                            text: formData.get('text'),
                            image_url: formData.get('image_url') || ''
                        };
                        response = await fetch('/api/add_news', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(jsonData)
                        });
                    }

                    const result = await response.json();
                    if (result.success) {
                        closeModal('add-news-modal');
                        // –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ç–∫—É
                        // –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é. –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É.
                        location.reload();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å'));
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
                }
            });
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.addEventListener('click', function(e) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    }
});
</script>
